name: Workflows Health

on:
  pull_request:
    paths:
      - ".github/workflows/**"
  push:
    branches: [ main ]
    paths:
      - ".github/workflows/**"

permissions:
  contents: read
  actions: read
  pull-requests: read

jobs:
  lint:
    name: Lint workflows (actionlint)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (workflows only)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          sparse-checkout: |
            .github/workflows
      - name: Run actionlint
        uses: rhysd/actionlint@v1
        with:
          # Relax a couple of noisy shellcheck rules commonly tripped by matrix/bash
          shellcheck_flags: -e SC2086 -e SC2046

  dry_run:
    name: Dry-run common actions
    # Skip on PRs to avoid secrets/permission noise; still runs on push to main
    if: github.event_name != 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Placeholder dry-run
        run: echo "Dry-run skipped for PRs; runs on main pushes."
